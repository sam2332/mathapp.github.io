<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>10 x 10 Multiplication Table </title>
      <style>
         .bold{
            font-weight: bold;
         }
         th, td {
             padding: 15px;
             text-align: center;
         }
         .good{
            background: green;
         }
         .bad {
            background: red;
         }
         .fixed {
            background: orange;
         }
         .skipped{
            background: blue;
         }
         .sidebyside{
             width:49%;
             text-align: center;
             float:right;
         }
         body{
            padding-top:15px;
         }
      </style>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
   </head>
   <body>
      <div>
         <div class='sidebyside'>
            <h2>History</h2>
            <div class='sidebyside'>
               <h3>Wrong</h3>
               <hr>
               <div id='wrong'></div>
            </div>
            <div class='sidebyside'>
               <h3>Right</h3>
               <hr>
               <div id='right'></div>
            </div>
         </div>
         <div class='sidebyside'>
            <table border="1px";>
               <thead>
                  <tr>
                     <th colspan="10">
                        10 x 10 Multiplication Table 
                     </th>
                  </tr>
               </thead>
               <tbody>
                  <tr class="bold">
                     <td id="1-1"class='head_1'>1</td>
                     <td id="1-2"class='head_2'>2</td>
                     <td id="1-3"class='head_3'>3</td>
                     <td id="1-4"class='head_4'>4</td>
                     <td id="1-5"class='head_5'>5</td>
                     <td id="1-6"class='head_6'>6</td>
                     <td id="1-7"class='head_7'>7</td>
                     <td id="1-8"class='head_8'>8</td>
                     <td id="1-9"class='head_9'>9</td>
                     <td id="1-10"class='head_10'>10</td>
                  </tr>
                  <tr>
                     <td id="2-1" class="bold head_2">2</td>
                     <td id="2-2" class="">4</td>
                     <td id="2-3">6</td>
                     <td id="2-4">8</td>
                     <td id="2-5">10</td>
                     <td id="2-6">12</td>
                     <td id="2-7">14</td>
                     <td id="2-8">16</td>
                     <td id="2-9">18</td>
                     <td id="2-10">20</td>
                  </tr>
                  <tr>
                     <td id="3-1" class="bold head_3">3</td>
                     <td id="3-2">6</td>
                     <td id="3-3">9</td>
                     <td id="3-4">12</td>
                     <td id="3-5">15</td>
                     <td id="3-6">18</td>
                     <td id="3-7">21</td>
                     <td id="3-8">24</td>
                     <td id="3-9">27</td>
                     <td id="3-10">30</td>
                  </tr>
                  <tr>
                     <td id="4-1" class="bold head_4">4</td>
                     <td id="4-2">8</td>
                     <td id="4-3">12</td>
                     <td id="4-4">16</td>
                     <td id="4-5">20</td>
                     <td id="4-6">24</td>
                     <td id="4-7">28</td>
                     <td id="4-8">32</td>
                     <td id="4-9">36</td>
                     <td id="4-10">40</td>
                  </tr>
                  <tr>
                     <td id="5-1" class="bold head_5">5</td>
                     <td id="5-2">10</td>
                     <td id="5-3">15</td>
                     <td id="5-4">20</td>
                     <td id="5-5">25</td>
                     <td id="5-6">30</td>
                     <td id="5-7">35</td>
                     <td id="5-8">40</td>
                     <td id="5-9">45</td>
                     <td id="5-10">50</td>
                  </tr>
                  <tr>
                     <td id="6-1" class="bold head_6">6</td>
                     <td id="6-2">12</td>
                     <td id="6-3">18</td>
                     <td id="6-4">24</td>
                     <td id="6-5">30</td>
                     <td id="6-6">36</td>
                     <td id="6-7">42</td>
                     <td id="6-8">48</td>
                     <td id="6-9">54</td>
                     <td id="6-10">60</td>
                  </tr>
                  <tr>
                     <td id="7-1" class="bold head_7">7</td>
                     <td id="7-2">14</td>
                     <td id="7-3">21</td>
                     <td id="7-4">28</td>
                     <td id="7-5">35</td>
                     <td id="7-6">42</td>
                     <td id="7-7">49</td>
                     <td id="7-8">56</td>
                     <td id="7-9">63</td>
                     <td id="7-10">70</td>
                  </tr>
                  <tr>
                     <td id="8-1" class="bold head_8">8</td>
                     <td id="8-2">16</td>
                     <td id="8-3">24</td>
                     <td id="8-4">32</td>
                     <td id="8-5">40</td>
                     <td id="8-6">48</td>
                     <td id="8-7">56</td>
                     <td id="8-8">64</td>
                     <td id="8-9">72</td>
                     <td id="8-10">80</td>
                  </tr>
                  <tr>
                     <td id="9-1" class="bold head_9">9</td>
                     <td id="9-2">18</td>
                     <td id="9-3">27</td>
                     <td id="9-4">36</td>
                     <td id="9-5">45</td>
                     <td id="9-6">54</td>
                     <td id="9-7">63</td>
                     <td id="9-8">72</td>
                     <td id="9-9">81</td>
                     <td id="9-10">90</td>
                  </tr>
                  <tr>
                     <td id="10-1" class="bold head_10">10</td>
                     <td id="10-2">20</td>
                     <td id="10-3">30</td>
                     <td id="10-4">40</td>
                     <td id="10-5">50</td>
                     <td id="10-6">60</td>
                     <td id="10-7">70</td>
                     <td id="10-8">80</td>
                     <td id="10-9">90</td>
                     <td id="10-10">100</td>
                  </tr>
               </tbody>
            </table>
         </div>
      </div>
      <hr style='clear: both;'>
      <p>
        Commands:<br>
        Stop, Pause: Pause game<br>
        Skip, Next : Next question
      </p>
      <button class='btn btn-primary '  onclick='start();' id="Start_btn">Start Game</button>
      <button class='btn  btn-primary' onclick='askagain();' style='display:none;' id="Resume_btn">Resume Game</button>
      <button class='btn  btn-warning'  onclick='askagain();' style='display:none;' id="Retry_btn">Repeat that</button>
      <button class='btn btn-danger'  onclick='next();' style='display:none;' id="Next_btn">Skip</button>
      <h2>Current Question</h2>
      <div id='question'></div>
      <hr>
      <h2>Transcription</h2>
      <div id='tran'></div>
      <hr>
      <script>

        // This code is bad do not try to learn from it.
        // if you learn bad habbits here i blame it on me learning vb6 before i knew how to be a human.

        /**
         * Shuffles array in place.
         * @param {Array} a items An array containing the items.
         */
        function shuffle(a) {
            var j, x, i;
            for (i = a.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                x = a[i];
                a[i] = a[j];
                a[j] = x;
            }
            return a;
        }
        
        window.math_problems = []
        for (var a = 1; a <= 10; a++) {
            for (var b = 1; b <= 10; b++) {
                window.math_problems[window.math_problems.length] = [a,' times ',b,a*b]
            }
        }

        function makeNextMathProblem() {
            console.log(window.math_problems.length)
            data = window.math_problems.pop(0)
            window.a = data[0]
            window.b= data[2]
            window.answer = data[3]
            return data[0] + data[1] +data[2]
        }

        window.asked = []
        window.wrong = []
        window.right = []
        window.answer = null;
        window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
        let finalTranscript = '';
        let recognition = new window.SpeechRecognition();
        recognition.interimResults = false;
        recognition.maxAlternatives = 10;
        recognition.continuous = false;
        window.last = new Date()

        recognition.onresult = (event) => {
            console.log(event)
            let interimTranscript = '';

            var dif = new Date().getTime() - window.last.getTime();

            var Seconds_from_T1_to_T2 = dif / 1000;
            var Seconds_Between_Dates = Math.abs(Seconds_from_T1_to_T2);

            for (let i = event.resultIndex, len = event.results.length; i < len; i++) {
                let transcript = event.results[i][0].transcript
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                } else {
                    interimTranscript += transcript;
                }
            }
            console.log(finalTranscript)
            if (finalTranscript == 'stop' || finalTranscript == 'pause') {
                document.querySelector('#Resume_btn').style.display = 'block'
                document.querySelector('#Next_btn').style.display = 'none'
                document.querySelector('#Retry_btn').style.display = 'none'
                
                speak("pausing");

                recognition.stop()
                return
            }
            if (finalTranscript == 'next' || finalTranscript == 'skip') {
                speak("skipping");
                var x = document.getElementById(window.a + "-" + window.b);
                x.className += ' skipped'
                recognition.stop()
                next()
                return
            }
            finalTranscript = finalTranscript.replace(/[a-z]/g, "");
            document.querySelector('#tran').innerHTML = "You said: " + finalTranscript + '<i style="color:#ddd;">' + interimTranscript + '</>';
            if (finalTranscript == window.answer) {

                document.querySelector('#right').innerHTML += '<br>' + document.querySelector('#question').innerHTML + " = " + finalTranscript + ' | ' + Seconds_Between_Dates

                var x = getCell(window.a ,window.b);
                if (x.indexOf('bad') != -1) {
                    speak("better, good job!");
                    markCell(window.a,window.b,'fixdd')
                } else {
                    speak("right answer!");
                    markCell(window.a,window.b,'good')
                }
                recognition.stop()
                finalTranscript = ''
                window.right[window.right.length] = window.a + '*' + window.b
                setTimeout(next, 2000)
            } else {
                if (finalTranscript.trim() == "") {
                    speak("I didnt understand, can you repeat?");
                } else {
                    speak("wrong answer, try again");

                    document.querySelector('#wrong').innerHTML += '<br>' + document.querySelector('#question').innerHTML + " = " + finalTranscript + ' | ' + Seconds_Between_Dates
                    markCell(window.a,window.b,'bad')

                    window.wrong[window.wrong.length] = window.a + '*' + window.b

                    window.math_problems[window.math_problems.length] = [window.a,' times ',window.b,window.a*window.b]
                    window.math_problems[window.math_problems.length] = [window.a,' times ',window.b,window.a*window.b]
                    window.math_problems[window.math_problems.length] = [window.a,' times ',window.b,window.a*window.b]
                    window.math_problems[window.math_problems.length] = [window.a,' times ',window.b,window.a*window.b]
                }
                recognition.stop()
                finalTranscript = ''
                setTimeout(askagain, 1500)
            }

        }
        function markCell(x,y,mode){
            var x = document.getElementById(x + "-" + y);
            x.className = mode
        }
        function getCell(x,y){
            var x = document.getElementById(x + "-" + y);
            return x.className

        }
        function speak(msg){
            speechSynthesis.speak(new SpeechSynthesisUtterance(msg));
        }

        function askagain() {
            document.querySelector('#Resume_btn').style.display = 'none'
            document.querySelector('#Next_btn').style.display = 'block'
            speak(window.question);
            window.last = new Date()
            setTimeout(function() {
                recognition.start();
            }, 700)
        }

        function start() {
            document.querySelector('#Start_btn').style.display = 'None'
            document.querySelector('#Retry_btn').style.display = 'block'
            document.querySelector('#Next_btn').style.display = 'block'

            next()
        }

        function next() {

            shuffle(window.math_problems)
            if (window.asked.length != 100) {
                window.last = new Date()
                window.question = makeNextMathProblem()
                document.querySelector('#question').innerHTML = window.question
                speak(window.question);
                setTimeout(function() {
                    recognition.start();
                }, 700)
            } else {
                alert('You have finished the test');
            }
        }
      </script>
   </body>
</html>
