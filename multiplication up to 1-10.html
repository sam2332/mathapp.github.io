<!DOCTYPE html>
<html>
    <head>
        <title>Page Title</title>
        <style>
            progress {  
                margin-left: -50px;
                transform: rotate(270deg) scale(5.5);
            }
            html{
                height: 100%;
            }
            .auto-v-middle{
                margin-top: auto;
                margin-bottom: auto;
            }
            #math_question_a,
            #math_question_operation,
            #math_question_b,
            #math_question_eq{
                font-size: 181px;
            }
            #math_question_answer {
                font-size: 125px;
                    vertical-align: initial;
            }
            #math_answer{
                width: 2em;
                outline: 5px solid black;
                -webkit-appearance: none; 
                margin: 0; 
            }
        </style>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    </head>
    <body class="h-100">

        <div  class="h-100" id='menuscreen'>
            questions?
            <input type='number' id='question_count'/><br>
            seconds
            <input type='number' id='question_seconds'/><br>
            <button id='start_btn'>Start</button>
        </div>
        <div class="h-100" id='reportscreen' style='display:none;'>
            <div id ='report'></div>
            <button id='restart_btn'>Restart</button>
        </div>
        <div class="h-100" id='gamescreen' style='display:none;'>
            <div id='points'>Good(0) Bad(0)</div>
            <div class='row h-100'>
                <div class='col-lg-8 auto-v-middle text-center'>
                    <span id='math_question_a'>a</span>
                    <span id='math_question_operation'>op</span>
                    <span id='math_question_b'>b</span>
                    <span id='math_question_eq'>=</span>
                    <span id='math_question_answer'><input id='math_answer' type='number'/></span>
                </div>
                <div class='col-lg-4 auto-v-middle text-center'>
                    <progress 
                      id='time_remaining'
                      max=30
                      min=0
                      value=30
                    ></progress>
                </div>
            </div>
        </div>
        <script>
            function buildReport(){

                out = ''
                out +='good('+window.good+') bad('+window.bad+')'

                return out
            }

            function endGame(){
                $('#gamescreen').hide()
                $('#report').html(buildReport())
                $('#reportscreen').show()
            }

            function startGameTimer(config){
                var ele = $('#time_remaining')
                var tr = window.game_length
                ele.attr('max',tr)
                ele.val(tr)
                window.gameTimer = setInterval(function(){
                    tr = tr - 1
                    ele.val(tr)
                    if (tr == 0){
                        clearInterval(window.gameTimer)
                        endGame()
                    }
                }.bind(this), 1000)
            }
            function choose(choices) {
              var index = Math.floor(Math.random() * choices.length);
              return choices[index];
            }
            function makeMathProblem(){
                var nQ = {
                    'a':Math.round(Math.random()*9)+1,
                    'op':choose(['*','/','+','-']),
                    'b': Math.round(Math.random()*9)+1
                }
                if (nQ['op'] == '*'){
                    window.question_answer = nQ['a'] * nQ['b']
                }
                if (nQ['op'] == '/'){
                    window.question_answer = nQ['a'] / nQ['b']
                }
                if (nQ['op'] == '-'){
                    window.question_answer = nQ['a'] - nQ['b']
                }
                if (nQ['op'] == '+'){
                    window.question_answer = nQ['a'] + nQ['b']
                }
                window.question_question = nQ
                renderQuestion()
            }
            
            function renderQuestion(){
                $('#math_question_a').text(window.question_question['a'])
                $('#math_question_operation').text(window.question_question['op'])
                $('#math_question_b').text(window.question_question['b'])
            }
            window.good = 0
            window.bad = 0
            function addGood(){
                window.good += 1
                $('#points').text('good('+window.good+') bad('+window.bad+')')
                $('#math_answer').css({'outline':'5px solid green'})
                setTimeout(function(){
                    $('#math_answer').css({'outline':''})
                },500)
                makeMathProblem()
            }
            function addBad(){
                window.bad += 1
                $('#points').text('good('+window.good+') bad('+window.bad+')')
                $('#math_answer').css({'outline':'5px solid red'})
                setTimeout(function(){
                    $('#math_answer').css({'outline':''})
                },500)
                makeMathProblem()
            }
            function checkAnswer(answer){
                console.log('checking answer',answer,window.question_answer)
                if (answer == window.question_answer)
                    addGood()
                else{
                    addBad()
                }
                $('#math_answer').val('')
            }
            $('#math_answer').on('keypress',function(e) {
                console.log(e)
                if(e.which == 13) {
                    checkAnswer($(this).val())
                }
            });      
            window.game_length = 60
            window.question_count = 50
            $('#question_count').val(window.question_count)
            $('#question_seconds').val(window.game_length)
            function runGame(){
                $('#gamescreen').show()
                $('#menuscreen').hide()

                startGameTimer()
                makeMathProblem()
            }
            $('#start_btn').click(function(){
                window.question_count =$('#question_count').val()
                window.game_length =$('#question_seconds').val()
                runGame();
            });
            $('#restart_btn').click(function(){
                document.location.reload()
            });
        </script>
    </body>
</html>